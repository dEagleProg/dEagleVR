var $e=Object.defineProperty;var et=(o,t,s)=>t in o?$e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var z=(o,t,s)=>(et(o,typeof t!="symbol"?t+"":t,s),s);import{l as je}from"./socket.io-client-5b158bf5.js";import{C as tt,G as it,D as st,T as at,V as nt,N as Te,S as u,E as rt,a as l,M as N,b as _,Q as ie,c as Pe,d as E,P as ot,W as ct,e as ht,f as lt,L as pt,g as ke,h as mt,i as dt,j as ut,A as ft,k as Se,R as yt,l as gt,m as bt,n as f,o as wt,p as vt,q as xt,r as Et,O as Tt,s as Pt}from"./three-13aeb5e0.js";import{e as se}from"./events-f5832a60.js";import{g as U}from"./gsap-4db78ffb.js";import{n as kt}from"./nipplejs-ee664c68.js";import"./engine.io-client-c72c876c.js";import"./engine.io-parser-11a11bb0.js";import"./@socket.io-3e1df240.js";import"./socket.io-parser-44417fca.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const T of a.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&e(T)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();class St extends se.EventEmitter{constructor(){super(),this.handleSizes(),window.addEventListener("resize",()=>{this.handleSizes(),this.emit("resize")})}handleSizes(){this.width=window.innerWidth,this.height=window.innerHeight,this.aspect=this.width/this.height,this.pixelRatio=Math.min(window.devicePixelRatio,2)}}class Mt{constructor(){this.start=Date.now(),this.current=this.start,this.elapsed=0,this.delta=16}update(){const t=Date.now();this.delta=(t-this.current)/1e3,this.current=t,this.delta>60&&(this.delta=60)}getDelta(){return this.delta}}class Lt{constructor(){this.loaders={},this.setLoaders()}setLoaders(){this.loaders.cubeTextureLoader=new tt,this.loaders.gltfLoader=new it,this.loaders.dracoLoader=new st,this.loaders.dracoLoader.setDecoderPath("/draco/"),this.loaders.gltfLoader.setDRACOLoader(this.loaders.dracoLoader),this.loaders.textureLoader=new at}}class Ot extends se.EventEmitter{constructor(t){super(),this.items={},this.assets=t,this.location="westgate",this.loaders=new Lt().loaders,this.startLoading()}startLoading(){this.loaded=0,this.queue=this.assets[0][this.location].assets.length;for(const t of this.assets[0][this.location].assets)t.type==="glbModel"?this.loaders.gltfLoader.load(t.path,s=>{this.singleAssetLoaded(t,s)}):t.type==="imageTexture"?this.loaders.textureLoader.load(t.path,s=>{this.singleAssetLoaded(t,s)}):t.type==="cubeTexture"?this.loaders.cubeTextureLoader.load(t.path,s=>{this.singleAssetLoaded(t,s)}):t.type==="videoTexture"&&(this.video={},this.videoTexture={},this.video[t.name]=document.createElement("video"),this.video[t.name].src=t.path,this.video[t.name].muted=!0,this.video[t.name].playsInline=!0,this.video[t.name].autoplay=!0,this.video[t.name].loop=!0,this.video[t.name].play(),this.videoTexture[t.name]=new nt(this.video[t.name]),this.videoTexture[t.name].flipY=!1,this.videoTexture[t.name].minFilter=Te,this.videoTexture[t.name].magFilter=Te,this.videoTexture[t.name].generateMipmaps=!1,this.videoTexture[t.name].ColorSpace=u,this.singleAssetLoaded(t,this.videoTexture[t.name]))}singleAssetLoaded(t,s){this.items[t.name]=s,this.loaded++,this.emit("loading",this.loaded,this.queue),this.loaded===this.queue&&this.emit("ready")}}const At=[{westgate:{assets:[{name:"screen",type:"glbModel",path:"/models/screen.glb"},{name:"glass",type:"glbModel",path:"/models/glass.glb"},{name:"male",type:"glbModel",path:"/models/asian_male_animated.glb"},{name:"female",type:"glbModel",path:"/models/asian_female_animated.glb"},{name:"bars",type:"glbModel",path:"/models/bars.glb"},{name:"brick",type:"glbModel",path:"/models/brick.glb"},{name:"buildings",type:"glbModel",path:"/models/buildings.glb"},{name:"easter",type:"glbModel",path:"/models/easter.glb"},{name:"everything",type:"glbModel",path:"/models/everything.glb"},{name:"floor",type:"glbModel",path:"/models/floor.glb"},{name:"grass",type:"glbModel",path:"/models/grass.glb"},{name:"other",type:"glbModel",path:"/models/other.glb"},{name:"outside",type:"glbModel",path:"/models/outside.glb"},{name:"panera",type:"glbModel",path:"/models/panera.glb"},{name:"plastic",type:"glbModel",path:"/models/plastic.glb"},{name:"tables",type:"glbModel",path:"/models/tables.glb"},{name:"box",type:"glbModel",path:"/models/box.glb"},{name:"thirdfloor",type:"glbModel",path:"/models/thirdfloor.glb"},{name:"collider",type:"glbModel",path:"/models/collider.glb"},{name:"barsTexture",type:"imageTexture",path:"textures/baked/bars.jpg"},{name:"brickTexture",type:"imageTexture",path:"textures/baked/brick.jpg"},{name:"buildingsTexture",type:"imageTexture",path:"textures/baked/buildings.jpg"},{name:"easterTexture",type:"imageTexture",path:"textures/baked/easter.jpg"},{name:"everythingTexture",type:"imageTexture",path:"textures/baked/everything.jpg"},{name:"floorTexture",type:"imageTexture",path:"textures/baked/floor.jpg"},{name:"grassTexture",type:"imageTexture",path:"textures/baked/grass.jpg"},{name:"otherTexture",type:"imageTexture",path:"textures/baked/other.webp"},{name:"outsideTexture",type:"imageTexture",path:"textures/baked/outside.jpg"},{name:"paneraTexture",type:"imageTexture",path:"textures/baked/panera.jpg"},{name:"plasticTexture",type:"imageTexture",path:"textures/baked/plastic.jpg"},{name:"tablesTexture",type:"imageTexture",path:"textures/baked/tables.jpg"},{name:"thirdfloorTexture",type:"imageTexture",path:"textures/baked/thirdfloor.jpg"},{name:"boxTexture",type:"imageTexture",path:"textures/baked/box.jpg"},{name:"environment",type:"cubeTexture",path:["textures/environment/px.png","textures/environment/nx.png","textures/environment/py.png","textures/environment/ny.png","textures/environment/pz.png","textures/environment/nz.png"]},{name:"video",type:"videoTexture",path:"/videos/tour.mp4"}]}}],Me={type:"change"},te={type:"start"},Le={type:"end"};class jt extends rt{constructor(t,s){super(),this.object=t,this.domElement=s,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new l,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:N.ROTATE,MIDDLE:N.DOLLY,RIGHT:N.PAN},this.touches={ONE:_.ROTATE,TWO:_.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return h.phi},this.getAzimuthalAngle=function(){return h.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(i){i.addEventListener("keydown",$),this._domElementKeyEvents=i},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",$),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(Me),e.update(),a=n.NONE},this.update=function(){const i=new l,r=new ie().setFromUnitVectors(t.up,new l(0,1,0)),m=r.clone().invert(),d=new l,v=new ie,R=2*Math.PI;return function(){const Ee=e.object.position;i.copy(Ee).sub(e.target),i.applyQuaternion(r),h.setFromVector3(i),e.autoRotate&&a===n.NONE&&F(Ne()),e.enableDamping?(h.theta+=y.theta*e.dampingFactor,h.phi+=y.phi*e.dampingFactor):(h.theta+=y.theta,h.phi+=y.phi);let S=e.minAzimuthAngle,M=e.maxAzimuthAngle;return isFinite(S)&&isFinite(M)&&(S<-Math.PI?S+=R:S>Math.PI&&(S-=R),M<-Math.PI?M+=R:M>Math.PI&&(M-=R),S<=M?h.theta=Math.max(S,Math.min(M,h.theta)):h.theta=h.theta>(S+M)/2?Math.max(S,h.theta):Math.min(M,h.theta)),h.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,h.phi)),h.makeSafe(),h.radius*=L,h.radius=Math.max(e.minDistance,Math.min(e.maxDistance,h.radius)),e.enableDamping===!0?e.target.addScaledVector(x,e.dampingFactor):e.target.add(x),i.setFromSpherical(h),i.applyQuaternion(m),Ee.copy(e.target).add(i),e.object.lookAt(e.target),e.enableDamping===!0?(y.theta*=1-e.dampingFactor,y.phi*=1-e.dampingFactor,x.multiplyScalar(1-e.dampingFactor)):(y.set(0,0,0),x.set(0,0,0)),L=1,A||d.distanceToSquared(e.object.position)>T||8*(1-v.dot(e.object.quaternion))>T?(e.dispatchEvent(Me),d.copy(e.object.position),v.copy(e.object.quaternion),A=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",we),e.domElement.removeEventListener("pointerdown",ye),e.domElement.removeEventListener("pointercancel",ge),e.domElement.removeEventListener("wheel",be),e.domElement.removeEventListener("pointermove",J),e.domElement.removeEventListener("pointerup",Q),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",$),e._domElementKeyEvents=null)};const e=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=n.NONE;const T=1e-6,h=new Pe,y=new Pe;let L=1;const x=new l;let A=!1;const g=new E,P=new E,k=new E,b=new E,O=new E,j=new E,I=new E,C=new E,Y=new E,c=[],W={};function Ne(){return 2*Math.PI/60/60*e.autoRotateSpeed}function B(){return Math.pow(.95,e.zoomSpeed)}function F(i){y.theta-=i}function H(i){y.phi-=i}const ne=function(){const i=new l;return function(m,d){i.setFromMatrixColumn(d,0),i.multiplyScalar(-m),x.add(i)}}(),re=function(){const i=new l;return function(m,d){e.screenSpacePanning===!0?i.setFromMatrixColumn(d,1):(i.setFromMatrixColumn(d,0),i.crossVectors(e.object.up,i)),i.multiplyScalar(m),x.add(i)}}(),D=function(){const i=new l;return function(m,d){const v=e.domElement;if(e.object.isPerspectiveCamera){const R=e.object.position;i.copy(R).sub(e.target);let V=i.length();V*=Math.tan(e.object.fov/2*Math.PI/180),ne(2*m*V/v.clientHeight,e.object.matrix),re(2*d*V/v.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(ne(m*(e.object.right-e.object.left)/e.object.zoom/v.clientWidth,e.object.matrix),re(d*(e.object.top-e.object.bottom)/e.object.zoom/v.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function G(i){e.object.isPerspectiveCamera?L/=i:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*i)),e.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function oe(i){e.object.isPerspectiveCamera?L*=i:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/i)),e.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ce(i){g.set(i.clientX,i.clientY)}function _e(i){I.set(i.clientX,i.clientY)}function he(i){b.set(i.clientX,i.clientY)}function Ye(i){P.set(i.clientX,i.clientY),k.subVectors(P,g).multiplyScalar(e.rotateSpeed);const r=e.domElement;F(2*Math.PI*k.x/r.clientHeight),H(2*Math.PI*k.y/r.clientHeight),g.copy(P),e.update()}function Fe(i){C.set(i.clientX,i.clientY),Y.subVectors(C,I),Y.y>0?G(B()):Y.y<0&&oe(B()),I.copy(C),e.update()}function qe(i){O.set(i.clientX,i.clientY),j.subVectors(O,b).multiplyScalar(e.panSpeed),D(j.x,j.y),b.copy(O),e.update()}function Ke(i){i.deltaY<0?oe(B()):i.deltaY>0&&G(B()),e.update()}function We(i){let r=!1;switch(i.code){case e.keys.UP:i.ctrlKey||i.metaKey?H(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):D(0,e.keyPanSpeed),r=!0;break;case e.keys.BOTTOM:i.ctrlKey||i.metaKey?H(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):D(0,-e.keyPanSpeed),r=!0;break;case e.keys.LEFT:i.ctrlKey||i.metaKey?F(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):D(e.keyPanSpeed,0),r=!0;break;case e.keys.RIGHT:i.ctrlKey||i.metaKey?F(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):D(-e.keyPanSpeed,0),r=!0;break}r&&(i.preventDefault(),e.update())}function le(){if(c.length===1)g.set(c[0].pageX,c[0].pageY);else{const i=.5*(c[0].pageX+c[1].pageX),r=.5*(c[0].pageY+c[1].pageY);g.set(i,r)}}function pe(){if(c.length===1)b.set(c[0].pageX,c[0].pageY);else{const i=.5*(c[0].pageX+c[1].pageX),r=.5*(c[0].pageY+c[1].pageY);b.set(i,r)}}function me(){const i=c[0].pageX-c[1].pageX,r=c[0].pageY-c[1].pageY,m=Math.sqrt(i*i+r*r);I.set(0,m)}function Be(){e.enableZoom&&me(),e.enablePan&&pe()}function He(){e.enableZoom&&me(),e.enableRotate&&le()}function de(i){if(c.length==1)P.set(i.pageX,i.pageY);else{const m=ee(i),d=.5*(i.pageX+m.x),v=.5*(i.pageY+m.y);P.set(d,v)}k.subVectors(P,g).multiplyScalar(e.rotateSpeed);const r=e.domElement;F(2*Math.PI*k.x/r.clientHeight),H(2*Math.PI*k.y/r.clientHeight),g.copy(P)}function ue(i){if(c.length===1)O.set(i.pageX,i.pageY);else{const r=ee(i),m=.5*(i.pageX+r.x),d=.5*(i.pageY+r.y);O.set(m,d)}j.subVectors(O,b).multiplyScalar(e.panSpeed),D(j.x,j.y),b.copy(O)}function fe(i){const r=ee(i),m=i.pageX-r.x,d=i.pageY-r.y,v=Math.sqrt(m*m+d*d);C.set(0,v),Y.set(0,Math.pow(C.y/I.y,e.zoomSpeed)),G(Y.y),I.copy(C)}function Ve(i){e.enableZoom&&fe(i),e.enablePan&&ue(i)}function Ue(i){e.enableZoom&&fe(i),e.enableRotate&&de(i)}function ye(i){e.enabled!==!1&&(c.length===0&&(e.domElement.setPointerCapture(i.pointerId),e.domElement.addEventListener("pointermove",J),e.domElement.addEventListener("pointerup",Q)),Qe(i),i.pointerType==="touch"?Ge(i):Xe(i))}function J(i){e.enabled!==!1&&(i.pointerType==="touch"?Je(i):Ze(i))}function Q(i){ve(i),c.length===0&&(e.domElement.releasePointerCapture(i.pointerId),e.domElement.removeEventListener("pointermove",J),e.domElement.removeEventListener("pointerup",Q)),e.dispatchEvent(Le),a=n.NONE}function ge(i){ve(i)}function Xe(i){let r;switch(i.button){case 0:r=e.mouseButtons.LEFT;break;case 1:r=e.mouseButtons.MIDDLE;break;case 2:r=e.mouseButtons.RIGHT;break;default:r=-1}switch(r){case N.DOLLY:if(e.enableZoom===!1)return;_e(i),a=n.DOLLY;break;case N.ROTATE:if(i.ctrlKey||i.metaKey){if(e.enablePan===!1)return;he(i),a=n.PAN}else{if(e.enableRotate===!1)return;ce(i),a=n.ROTATE}break;case N.PAN:if(i.ctrlKey||i.metaKey){if(e.enableRotate===!1)return;ce(i),a=n.ROTATE}else{if(e.enablePan===!1)return;he(i),a=n.PAN}break;default:a=n.NONE}a!==n.NONE&&e.dispatchEvent(te)}function Ze(i){switch(a){case n.ROTATE:if(e.enableRotate===!1)return;Ye(i);break;case n.DOLLY:if(e.enableZoom===!1)return;Fe(i);break;case n.PAN:if(e.enablePan===!1)return;qe(i);break}}function be(i){e.enabled===!1||e.enableZoom===!1||a!==n.NONE||(i.preventDefault(),e.dispatchEvent(te),Ke(i),e.dispatchEvent(Le))}function $(i){e.enabled===!1||e.enablePan===!1||We(i)}function Ge(i){switch(xe(i),c.length){case 1:switch(e.touches.ONE){case _.ROTATE:if(e.enableRotate===!1)return;le(),a=n.TOUCH_ROTATE;break;case _.PAN:if(e.enablePan===!1)return;pe(),a=n.TOUCH_PAN;break;default:a=n.NONE}break;case 2:switch(e.touches.TWO){case _.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Be(),a=n.TOUCH_DOLLY_PAN;break;case _.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;He(),a=n.TOUCH_DOLLY_ROTATE;break;default:a=n.NONE}break;default:a=n.NONE}a!==n.NONE&&e.dispatchEvent(te)}function Je(i){switch(xe(i),a){case n.TOUCH_ROTATE:if(e.enableRotate===!1)return;de(i),e.update();break;case n.TOUCH_PAN:if(e.enablePan===!1)return;ue(i),e.update();break;case n.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ve(i),e.update();break;case n.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ue(i),e.update();break;default:a=n.NONE}}function we(i){e.enabled!==!1&&i.preventDefault()}function Qe(i){c.push(i)}function ve(i){delete W[i.pointerId];for(let r=0;r<c.length;r++)if(c[r].pointerId==i.pointerId){c.splice(r,1);return}}function xe(i){let r=W[i.pointerId];r===void 0&&(r=new E,W[i.pointerId]=r),r.set(i.pageX,i.pageY)}function ee(i){const r=i.pointerId===c[0].pointerId?c[1]:c[0];return W[r.pointerId]}e.domElement.addEventListener("contextmenu",we),e.domElement.addEventListener("pointerdown",ye),e.domElement.addEventListener("pointercancel",ge),e.domElement.addEventListener("wheel",be,{passive:!1}),this.update()}}class It{constructor(){this.experience=new w,this.sizes=this.experience.sizes,this.scene=this.experience.scene,this.canvas=this.experience.canvas,this.params={fov:75,aspect:this.sizes.aspect,near:.001,far:1e3},this.controls=null,this.setPerspectiveCamera(),this.setOrbitControls()}setPerspectiveCamera(){this.perspectiveCamera=new ot(this.params.fov,this.params.aspect,this.params.near,this.params.far),this.perspectiveCamera.position.set(17.8838,1.2+10,-3.72508),this.perspectiveCamera.rotation.y=Math.PI/2,this.scene.add(this.perspectiveCamera)}setOrbitControls(){this.controls=new jt(this.perspectiveCamera,this.canvas),this.controls.enableDamping=!0,this.controls.enablePan=!1,this.controls.maxDistance=6,this.controls.dampingFactor=.1}enableOrbitControls(){this.controls.enabled=!0}disableOrbitControls(){this.controls.enabled=!1}onResize(){this.perspectiveCamera.aspect=this.sizes.aspect,this.perspectiveCamera.updateProjectionMatrix()}update(){this.controls&&this.controls.enabled===!0&&this.controls.update()}}class Ct{constructor(){this.experience=new w,this.sizes=this.experience.sizes,this.scene=this.experience.scene,this.canvas=this.experience.canvas,this.camera=this.experience.camera,this.setRenderer()}setRenderer(){this.renderer=new ct({canvas:this.canvas,antialias:!0,logarithmicDepthBuffer:!0}),this.renderer.outputColorSpace=u,this.renderer.toneMapping=ht,this.renderer.toneMappingExposure=1.5,this.renderer.setSize(this.sizes.width,this.sizes.height),this.renderer.setPixelRatio(this.sizes.pixelRatio)}onResize(){this.renderer.setSize(this.sizes.width,this.sizes.height),this.renderer.setPixelRatio(this.sizes.pixelRatio)}update(){this.renderer.render(this.scene,this.camera.perspectiveCamera)}}function ae(o){let t={};return Object.entries(o).forEach(s=>{const e=s[0],n=s[1];t[e]=document.querySelector(n)}),t}class Dt{constructor(){z(this,"onNameInput",()=>{this.domElements.nameInput.value!==""&&this.nameInputOutro()});z(this,"onCharacterSelect",()=>{this.preloaderOutro()});this.experience=new w,this.resources=this.experience.resources,this.matchmedia=U.matchMedia(),this.loaded=0,this.queue=0,this.counter=0,this.amountDone=0,this.domElements=ae({preloader:".preloader",text1:".preloader-percentage1",text2:".preloader-percentage2",progressBar:".progress-bar",svgLogo:".svgLogo",progressBarContainer:".progress-bar-container",progressWrapper:".progress-wrapper",preloaderTitle:".preloader-title",preloaderWrapper:".preloader-wrapper",welcomeTitle:".welcome-title",nameForm:".name-form",nameInput:"#name-input",nameInputButton:"#name-input-button",characterSelectTitle:".character-select-title",avatarWrapper:".avatar-img-wrapper",avatarLeftImg:".avatar-left",avatarRightImg:".avatar-right",customizeButton:".customize-character-btn",description:".description"}),this.resources.on("loading",(t,s)=>{this.updateProgress(t,s)}),this.resources.on("ready",()=>{this.playIntro()}),this.addEventListeners()}updateProgress(t,s){this.amountDone=Math.round(t/s*100)}async playIntro(){return new Promise(t=>{this.timeline=new U.timeline,this.timeline.to(this.domElements.svgLogo,{opacity:0,duration:1.2,delay:2.2,top:"-120%",ease:"power4.out"}).to(this.domElements.progressBarContainer,{opacity:0,duration:1.2,top:"30%",ease:"power4.out"},"-=1.05").to(this.domElements.progressWrapper,{opacity:0,duration:1.2,bottom:"21%",ease:"power4.out"},"-=1.05").to(this.domElements.description,{opacity:0,duration:1.2,bottom:"35%",ease:"power4.out"},"-=1.05").to(this.domElements.preloaderTitle,{opacity:0,duration:1.2,bottom:"18%",ease:"power4.out",onUpdate:()=>{this.domElements.preloaderTitle.classList.remove("fade-in-out")},onComplete:()=>{this.domElements.svgLogo.remove(),this.domElements.progressBarContainer.remove(),this.domElements.progressWrapper.remove(),this.domElements.preloaderTitle.remove(),this.domElements.preloaderWrapper.remove()}},"-=1.05").to(this.domElements.welcomeTitle,{opacity:1,duration:1.2,top:"37%",ease:"power4.out"},"-=1").to(this.domElements.nameForm,{opacity:1,duration:1.2,top:"50%",ease:"power4.out"},"-=1").to(this.domElements.nameInputButton,{opacity:1,duration:1.2,bottom:"39%",ease:"power4.out",onComplete:()=>{}},"-=1")})}async nameInputOutro(){return new Promise(t=>{this.timeline2=new U.timeline,this.timeline2.to(this.domElements.welcomeTitle,{opacity:0,duration:1.2,top:"34%",ease:"power4.out"}).to(this.domElements.nameForm,{opacity:0,duration:1.2,top:"44%",ease:"power4.out"},"-=1.05").to(this.domElements.nameInputButton,{opacity:0,duration:1.2,bottom:"47%",ease:"power4.out",onComplete:()=>{this.domElements.welcomeTitle.remove(),this.domElements.nameForm.remove(),this.domElements.nameInputButton.remove(),this.domElements.avatarLeftImg.style.pointerEvents="auto",this.domElements.avatarRightImg.style.pointerEvents="auto"}},"-=1.05").to(this.domElements.characterSelectTitle,{opacity:1,duration:1.2,top:"20%",ease:"power4.out"},"-=1.05").to(this.domElements.avatarWrapper,{opacity:1,duration:1.2,bottom:"47%",ease:"power4.out"},"-=1.05").to(this.domElements.customizeButton,{opacity:1,duration:1.2,bottom:"25%",ease:"power4.out"},"-=1.05")})}async preloaderOutro(){return new Promise(t=>{this.timeline3=new U.timeline,this.timeline3.to(this.domElements.preloader,{duration:1.7,opacity:0,ease:"power3.out",onComplete:()=>{this.domElements.preloader.remove()}})})}addEventListeners(){this.domElements.nameInputButton.addEventListener("click",this.onNameInput),this.domElements.avatarLeftImg.addEventListener("click",this.onCharacterSelect),this.domElements.avatarRightImg.addEventListener("click",this.onCharacterSelect)}update(){this.counter<this.amountDone&&(this.counter++,this.domElements.text1.innerText=Math.round(this.counter/10),Math.round(this.counter/10)!==10?(this.domElements.text2.innerText=Math.round(this.counter%10),this.flag=!1):(this.domElements.text2.innerText=0,this.flag=!0),this.domElements.progressBar.style.width=Math.round(this.counter)+"%",this.flag&&(this.domElements.progressBar.style.width="100%"))}}class Rt{constructor(){this.experience=new w,this.resources=this.experience.resources,this.scene=this.experience.scene,this.nametag=""}createNametag(t=16,s=150,e="John Doe"){const a=document.createElement("canvas").getContext("2d"),T=`200 ${t}px Arial`;a.font=T;const h=a.measureText(e).width,y=2*2,L=s+y,x=t+y;a.canvas.width=L,a.canvas.height=x,a.font=T,a.textBaseline="middle",a.textAlign="center",a.fillStyle="rgba(0, 0, 0, 0.5)",a.fillRect(0,0,L,x);const A=Math.min(1,s/h);a.translate(L/2,x/2),a.scale(A,1),a.fillStyle="white",a.fillText(e,0,0);const g=new lt(a.canvas);g.minFilter=pt,g.wrapS=ke,g.wrapT=ke;const P=new mt({map:g,transparent:!0}),k=.01,b=new dt(P);return b.position.y=5,b.scale.x=a.canvas.width*k,b.scale.y=a.canvas.height*k,b}update(){}}class Oe{constructor(t,s,e="Anonymous",n){this.scene=s,this.name=new Rt,this.nametag=this.name.createNametag(16,150,e),this.avatar=ut(t.scene),this.avatar.userData.id=n,this.avatar.animations=t.animations.map(a=>a.clone()),this.setAvatar()}setAvatar(){this.speedAdjustment=1,this.avatar.scale.set(.99,.99,.99),this.setAnimation(),this.scene.add(this.avatar),this.avatar.userData.id&&this.scene.add(this.nametag)}setAnimation(){this.animation={},this.animation.mixer=new ft(this.avatar),this.animation.actions={},this.animation.actions.dancing=this.animation.mixer.clipAction(this.avatar.animations[0]),this.animation.actions.idle=this.animation.mixer.clipAction(this.avatar.animations[1]),this.animation.actions.jumping=this.animation.mixer.clipAction(this.avatar.animations[2]),this.animation.actions.running=this.animation.mixer.clipAction(this.avatar.animations[3]),this.animation.actions.walking=this.animation.mixer.clipAction(this.avatar.animations[4]),this.animation.actions.waving=this.animation.mixer.clipAction(this.avatar.animations[5]),this.animation.actions.current=this.animation.actions.idle,this.animation.actions.current.play(),this.animation.play=t=>{const s=this.animation.actions[t],e=this.animation.actions.current;e!==s&&(this.animation.actions.current==="jumping"?this.speedAdjustment=1.5:this.speedAdjustment=1,s.reset(),s.play(),s.crossFadeFrom(e,.2),this.animation.actions.current=s)},this.animation.update=t=>{this.animation.mixer.update(t*this.speedAdjustment)}}}class zt{constructor(){z(this,"onKeyDown",t=>{document.activeElement!==this.domElements.messageInput&&((t.code==="KeyW"||t.code==="ArrowUp")&&(this.actions.forward=!0),(t.code==="KeyS"||t.code==="ArrowDown")&&(this.actions.backward=!0),(t.code==="KeyA"||t.code==="ArrowLeft")&&(this.actions.left=!0),(t.code==="KeyD"||t.code==="ArrowRight")&&(this.actions.right=!0),!this.actions.run&&!this.actions.jump&&(this.player.animation="walking"),t.code==="KeyO"&&(this.player.animation="dancing"),t.code==="ShiftLeft"&&(this.actions.run=!0,this.player.animation="running"),t.code==="Space"&&!this.actions.jump&&this.player.onFloor&&(this.actions.jump=!0,this.player.animation="jumping",this.jumpOnce=!0))});z(this,"onKeyUp",t=>{(t.code==="KeyW"||t.code==="ArrowUp")&&(this.actions.forward=!1),(t.code==="KeyS"||t.code==="ArrowDown")&&(this.actions.backward=!1),(t.code==="KeyA"||t.code==="ArrowLeft")&&(this.actions.left=!1),(t.code==="KeyD"||t.code==="ArrowRight")&&(this.actions.right=!1),t.code==="ShiftLeft"&&(this.actions.run=!1),this.player.onFloor&&(this.actions.run?this.player.animation="running":this.actions.forward||this.actions.backward||this.actions.left||this.actions.right?this.player.animation="walking":this.player.animation="idle"),t.code==="Space"&&(this.actions.jump=!1)});this.experience=new w,this.time=this.experience.time,this.scene=this.experience.scene,this.camera=this.experience.camera,this.octree=this.experience.world.octree,this.resources=this.experience.resources,this.socket=this.experience.socket,this.domElements=ae({joystickArea:".joystick-area",controlOverlay:".control-overlay",messageInput:"#chat-message-input",switchViewButton:".switch-camera-view"}),this.initPlayer(),this.initControls(),this.setPlayerSocket(),this.setJoyStick(),this.addEventListeners()}initPlayer(){this.player={},this.player.body=this.camera.perspectiveCamera,this.player.animation="idle",this.jumpOnce=!1,this.player.onFloor=!1,this.player.gravity=60,this.player.spawn={position:new l,rotation:new Se,velocity:new l},this.player.raycaster=new yt,this.player.raycaster.far=5,this.player.height=1.2,this.player.speedMultiplier=.35,this.player.position=new l,this.player.quaternion=new Se,this.player.directionOffset=0,this.targetRotation=new ie,this.upVector=new l(0,1,0),this.player.velocity=new l,this.player.direction=new l,this.player.collider=new gt(new l,new l,.35),this.otherPlayers={},this.socket.emit("setID"),this.socket.emit("initPlayer",this.player)}initControls(){this.actions={},this.coords={previousX:0,previousY:0,currentX:0,currentY:0},this.joystickVector=new l}setJoyStick(){this.options={zone:this.domElements.joystickArea,mode:"dynamic"},this.joystick=kt.create(this.options),this.joystick.on("move",(t,s)=>{this.actions.movingJoyStick=!0,this.joystickVector.z=-s.vector.y,this.joystickVector.x=s.vector.x}),this.joystick.on("end",()=>{this.actions.movingJoyStick=!1})}setPlayerSocket(){this.socket.on("setID",(t,s)=>{}),this.socket.on("setAvatarSkin",(t,s)=>{!this.avatar&&s===this.socket.id&&(this.player.avatarSkin=t,this.avatar=new Oe(this.resources.items[t],this.scene),this.updatePlayerSocket())}),this.socket.on("playerData",t=>{for(let s of t)s.id!==this.socket.id&&(this.scene.traverse(e=>{if(e.userData.id!==s.id&&!this.otherPlayers.hasOwnProperty(s.id)){if(s.name===""||s.avatarSkin==="")return;const n=s.name.substring(0,25),a=new Oe(this.resources.items[s.avatarSkin],this.scene,n,s.id);s.model=a,this.otherPlayers[s.id]=s}}),this.otherPlayers[s.id]&&(this.otherPlayers[s.id].position={position_x:s.position_x,position_y:s.position_y,position_z:s.position_z},this.otherPlayers[s.id].quaternion={quaternion_x:s.quaternion_x,quaternion_y:s.quaternion_y,quaternion_z:s.quaternion_z,quaternion_w:s.quaternion_w},this.otherPlayers[s.id].animation={animation:s.animation}))}),this.socket.on("removePlayer",t=>{this.disconnectedPlayerId=t,this.otherPlayers[t].model.nametag.material.dispose(),this.otherPlayers[t].model.nametag.geometry.dispose(),this.scene.remove(this.otherPlayers[t].model.nametag),this.otherPlayers[t].model.avatar.traverse(s=>{s instanceof bt&&(s.material.dispose(),s.geometry.dispose()),s.material&&s.material.dispose(),s.geometry&&s.geometry.dispose()}),this.scene.remove(this.otherPlayers[t].model.avatar),delete this.otherPlayers[t].nametag,delete this.otherPlayers[t].model,delete this.otherPlayers[t]})}updatePlayerSocket(){setInterval(()=>{this.avatar&&this.socket.emit("updatePlayer",{position:this.avatar.avatar.position,quaternion:this.avatar.avatar.quaternion,animation:this.player.animation,avatarSkin:this.player.avatarSkin})},20)}playerCollisions(){const t=this.octree.capsuleIntersect(this.player.collider);this.player.onFloor=!1,t&&(this.player.onFloor=t.normal.y>0,this.player.collider.translate(t.normal.multiplyScalar(t.depth)))}getForwardVector(){return this.camera.perspectiveCamera.getWorldDirection(this.player.direction),this.player.direction.y=0,this.player.direction.normalize(),this.player.direction}getSideVector(){return this.camera.perspectiveCamera.getWorldDirection(this.player.direction),this.player.direction.y=0,this.player.direction.normalize(),this.player.direction.cross(this.camera.perspectiveCamera.up),this.player.direction}getJoyStickDirectionalVector(){let t=new l;return t.copy(this.joystickVector),t.applyQuaternion(this.camera.perspectiveCamera.quaternion),t.y=0,t.multiplyScalar(1.5),t}addEventListeners(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}resize(){}spawnPlayerOutOfBounds(){const t=new l(-22.4437,13,-15.0529);this.player.velocity=this.player.spawn.velocity,this.player.collider.start.copy(t),this.player.collider.end.copy(t),this.player.collider.end.y+=this.player.height}updateColliderMovement(){const t=(this.player.onFloor?1.75:.1)*this.player.gravity*this.player.speedMultiplier;let s=this.time.delta*t;this.actions.movingJoyStick&&this.player.velocity.add(this.getJoyStickDirectionalVector()),this.actions.run&&(s*=2.5),this.actions.forward&&this.player.velocity.add(this.getForwardVector().multiplyScalar(s)),this.actions.backward&&this.player.velocity.add(this.getForwardVector().multiplyScalar(-s)),this.actions.left&&this.player.velocity.add(this.getSideVector().multiplyScalar(-s)),this.actions.right&&this.player.velocity.add(this.getSideVector().multiplyScalar(s)),this.player.onFloor&&(this.actions.jump&&this.jumpOnce&&(this.player.velocity.y=12),this.jumpOnce=!1);let e=Math.exp(-15*this.time.delta)-1;this.player.onFloor||(this.player.animation==="jumping"?this.player.velocity.y-=this.player.gravity*.7*this.time.delta:this.player.velocity.y-=this.player.gravity*this.time.delta,e*=.1),this.player.velocity.addScaledVector(this.player.velocity,e);const n=this.player.velocity.clone().multiplyScalar(this.time.delta);this.player.collider.translate(n),this.playerCollisions(),this.player.body.position.sub(this.camera.controls.target),this.camera.controls.target.copy(this.player.collider.end),this.player.body.position.add(this.player.collider.end),this.player.body.updateMatrixWorld(),this.player.body.position.y<-20&&this.spawnPlayerOutOfBounds()}setInteractionObjects(t){this.player.interactionObjects=t}getgetCameraLookAtDirectionalVector(){return new l(0,0,-1).applyQuaternion(this.camera.perspectiveCamera.quaternion)}updateRaycaster(){this.player.raycaster.ray.origin.copy(this.camera.perspectiveCamera.position),this.player.raycaster.ray.direction.copy(this.getgetCameraLookAtDirectionalVector());const t=this.player.raycaster.intersectObjects(this.player.interactionObjects.children);t.length===0?this.currentIntersectObject="":this.currentIntersectObject=t[0].object.name,this.currentIntersectObject!==this.previousIntersectObject&&(this.previousIntersectObject=this.currentIntersectObject)}updateAvatarPosition(){this.avatar.avatar.position.copy(this.player.collider.end),this.avatar.avatar.position.y-=1.56,this.avatar.animation.update(this.time.delta)}updateOtherPlayers(){for(let t in this.otherPlayers)this.otherPlayers[t].model.avatar.position.set(this.otherPlayers[t].position.position_x,this.otherPlayers[t].position.position_y,this.otherPlayers[t].position.position_z),this.otherPlayers[t].model.animation.play(this.otherPlayers[t].animation.animation),this.otherPlayers[t].model.animation.update(this.time.delta),this.otherPlayers[t].model.avatar.quaternion.set(this.otherPlayers[t].quaternion.quaternion_x,this.otherPlayers[t].quaternion.quaternion_y,this.otherPlayers[t].quaternion.quaternion_z,this.otherPlayers[t].quaternion.quaternion_w),this.otherPlayers[t].model.nametag.position.set(this.otherPlayers[t].position.position_x,this.otherPlayers[t].position.position_y+2.1,this.otherPlayers[t].position.position_z)}updateAvatarRotation(){this.actions.forward&&(this.player.directionOffset=Math.PI),this.actions.backward&&(this.player.directionOffset=0),this.actions.left&&(this.player.directionOffset=-Math.PI/2),this.actions.forward&&this.actions.left&&(this.player.directionOffset=Math.PI+Math.PI/4),this.actions.backward&&this.actions.left&&(this.player.directionOffset=-Math.PI/4),this.actions.right&&(this.player.directionOffset=Math.PI/2),this.actions.forward&&this.actions.right&&(this.player.directionOffset=Math.PI-Math.PI/4),this.actions.backward&&this.actions.right&&(this.player.directionOffset=Math.PI/4),this.actions.forward&&this.actions.left&&this.actions.right&&(this.player.directionOffset=Math.PI),this.actions.backward&&this.actions.left&&this.actions.right&&(this.player.directionOffset=0),this.actions.right&&this.actions.backward&&this.actions.forward&&(this.player.directionOffset=Math.PI/2),this.actions.left&&this.actions.backward&&this.actions.forward&&(this.player.directionOffset=-Math.PI/2)}updateAvatarAnimation(){this.player.animation!==this.avatar.animation?(this.actions.left&&this.actions.right&&!this.actions.forward&&!this.actions.backward&&(this.player.animation="idle"),!this.actions.left&&!this.actions.right&&this.actions.forward&&this.actions.backward&&(this.player.animation="idle"),this.actions.left&&this.actions.right&&this.actions.forward&&this.actions.backward&&(this.player.animation="idle"),!this.actions.left&&!this.actions.right&&!this.actions.forward&&!this.actions.backward&&this.actions.run&&(this.player.animation="idle"),this.actions.run&&this.actions.left&&this.actions.right&&this.actions.forward&&!this.actions.backward&&(this.player.animation="running"),this.actions.run&&this.actions.left&&this.actions.right&&this.actions.backward&&!this.actions.forward&&(this.player.animation="running"),this.actions.run&&!this.actions.left&&!this.actions.right&&this.actions.forward&&!this.actions.backward&&this.player.animation!=="jumping"&&(this.player.animation="running"),this.actions.run&&!this.actions.left&&!this.actions.right&&this.actions.backward&&!this.actions.forward&&this.player.animation!=="jumping"&&(this.player.animation="running"),this.actions.run&&!this.actions.left&&!this.actions.right&&this.actions.backward&&this.actions.forward&&this.player.animation!=="jumping"&&(this.player.animation="idle"),this.actions.run&&this.actions.left&&this.actions.right&&!this.actions.backward&&!this.actions.forward&&this.player.animation!=="jumping"&&(this.player.animation="idle"),this.actions.run&&!this.actions.left&&this.actions.right&&!this.actions.backward&&this.actions.forward&&this.player.animation!=="jumping"&&(this.player.animation="running"),this.actions.run&&this.actions.left&&!this.actions.right&&this.actions.backward&&!this.actions.forward&&this.player.animation!=="jumping"&&(this.player.animation="running"),this.actions.run&&this.actions.left&&!this.actions.right&&!this.actions.backward&&!this.actions.forward&&this.player.animation!=="jumping"&&(this.player.animation="running"),this.actions.run&&!this.actions.left&&this.actions.right&&!this.actions.backward&&!this.actions.forward&&this.player.animation!=="jumping"&&(this.player.animation="running"),this.actions.run&&!this.actions.left&&!this.actions.right&&!this.actions.backward&&!this.actions.forward&&this.actions.jump&&(this.player.animation="jumping"),this.player.animation==="jumping"&&!this.jumpOnce&&this.player.onFloor&&(this.actions.run?this.player.animation="running":this.actions.forward||this.actions.backward||this.actions.left||this.actions.right?this.player.animation="walking":this.player.animation="idle"),this.avatar.animation.play(this.player.animation)):this.avatar.animation.play("idle")}updateCameraPosition(){if(this.player.animation!=="idle"&&this.player.animation!=="dancing"){const t=Math.atan2(this.player.body.position.x-this.avatar.avatar.position.x,this.player.body.position.z-this.avatar.avatar.position.z);this.targetRotation.setFromAxisAngle(this.upVector,t+this.player.directionOffset),this.avatar.avatar.quaternion.rotateTowards(this.targetRotation,.15)}}update(){this.avatar&&(this.updateColliderMovement(),this.updateAvatarPosition(),this.updateAvatarRotation(),this.updateAvatarAnimation(),this.updateCameraPosition(),this.updateOtherPlayers())}}class Nt{constructor(){this.experience=new w,this.scene=this.experience.scene,this.resources=this.experience.resources,this.octree=this.experience.world.octree,this.setWorld()}setWorld(){this.bars=this.resources.items.bars.scene,this.brick=this.resources.items.brick.scene,this.buildings=this.resources.items.buildings.scene,this.easter=this.resources.items.easter.scene,this.everything=this.resources.items.everything.scene,this.floor=this.resources.items.floor.scene,this.grass=this.resources.items.grass.scene,this.other=this.resources.items.other.scene,this.outside=this.resources.items.outside.scene,this.panera=this.resources.items.panera.scene,this.plastic=this.resources.items.plastic.scene,this.tables=this.resources.items.tables.scene,this.thirdfloor=this.resources.items.thirdfloor.scene,this.box=this.resources.items.box.scene,this.glass=this.resources.items.glass.scene,this.screen=this.resources.items.screen.scene,this.screen.children[0].material=new f({map:this.resources.items.video}),this.screen.children[0].material.flipY=!1,this.collider=this.resources.items.collider.scene,this.octree.fromGraphNode(this.collider),this.glass.children.forEach(t=>{t.material=new wt,t.material.roughness=0,t.material.color.set(14673397),t.material.ior=1.5,t.material.transmission=1,t.material.opacity=1}),this.box.children.forEach(t=>{this.resources.items.boxTexture.flipY=!1,this.resources.items.boxTexture.colorSpace=u,t.material=new f({map:this.resources.items.boxTexture})}),this.bars.children.forEach(t=>{this.resources.items.barsTexture.flipY=!1,this.resources.items.barsTexture.colorSpace=u,t.material=new f({map:this.resources.items.barsTexture})}),this.brick.children.forEach(t=>{this.resources.items.brickTexture.flipY=!1,this.resources.items.brickTexture.colorSpace=u,t.material=new f({map:this.resources.items.brickTexture})}),this.buildings.children.forEach(t=>{this.resources.items.buildingsTexture.flipY=!1,this.resources.items.buildingsTexture.colorSpace=u,t.material=new f({map:this.resources.items.buildingsTexture})}),this.easter.children.forEach(t=>{this.resources.items.easterTexture.flipY=!1,this.resources.items.easterTexture.colorSpace=u,t.material=new f({map:this.resources.items.easterTexture})}),this.everything.children.forEach(t=>{this.resources.items.everythingTexture.flipY=!1,this.resources.items.everythingTexture.colorSpace=u,t.material=new f({map:this.resources.items.everythingTexture})}),this.floor.children.forEach(t=>{this.resources.items.floorTexture.flipY=!1,this.resources.items.floorTexture.colorSpace=u,t.material=new f({map:this.resources.items.floorTexture})}),this.grass.children.forEach(t=>{this.resources.items.grassTexture.flipY=!1,this.resources.items.grassTexture.colorSpace=u,t.material=new f({map:this.resources.items.grassTexture})}),this.other.children.forEach(t=>{this.resources.items.otherTexture.flipY=!1,this.resources.items.otherTexture.colorSpace=u,t.material=new f({map:this.resources.items.otherTexture,alphaTest:.5,side:vt})}),this.outside.children.forEach(t=>{this.resources.items.outsideTexture.flipY=!1,this.resources.items.outsideTexture.colorSpace=u,t.material=new f({map:this.resources.items.outsideTexture})}),this.panera.children.forEach(t=>{this.resources.items.paneraTexture.flipY=!1,this.resources.items.paneraTexture.colorSpace=u,t.material=new f({map:this.resources.items.paneraTexture})}),this.plastic.children.forEach(t=>{this.resources.items.plasticTexture.flipY=!1,this.resources.items.plasticTexture.colorSpace=u,t.material=new f({map:this.resources.items.plasticTexture})}),this.tables.children.forEach(t=>{this.resources.items.tablesTexture.flipY=!1,this.resources.items.tablesTexture.colorSpace=u,t.material=new f({map:this.resources.items.tablesTexture})}),this.thirdfloor.children.forEach(t=>{this.resources.items.thirdfloorTexture.flipY=!1,this.resources.items.thirdfloorTexture.colorSpace=u,t.material=new f({map:this.resources.items.thirdfloorTexture})}),this.scene.add(this.glass),this.scene.add(this.screen),this.scene.add(this.bars),this.scene.add(this.brick),this.scene.add(this.buildings),this.scene.add(this.easter),this.scene.add(this.everything),this.scene.add(this.floor),this.scene.add(this.grass),this.scene.add(this.other),this.scene.add(this.outside),this.scene.add(this.panera),this.scene.add(this.plastic),this.scene.add(this.box),this.scene.add(this.tables),this.scene.add(this.thirdfloor)}}class _t{constructor(){this.experience=new w,this.scene=this.experience.scene,this.resources=this.experience.resources,this.setEnvironment()}setEnvironment(){this.environmentMap={},this.environmentMap.intensity=0,this.environmentMap.texture=this.resources.items.environment,this.environmentMap.texture.outputColorSpace=u,this.scene.background=this.environmentMap.texture;const t=new xt(4210752,4);this.scene.add(t),this.sunLight=new Et("#ffffff",1.5),this.sunLight.position.set(1.5,7,-3),this.scene.add(this.sunLight)}update(){}}class Yt extends se.EventEmitter{constructor(){super(),this.experience=new w,this.resources=this.experience.resources,this.octree=new Tt,this.player=null,this.resources.on("ready",()=>{this.player===null&&(this.westgate=new Nt,this.player=new zt,this.environment=new _t)})}update(){this.player&&this.player.update()}}const q=class{constructor(t,s){if(q.instance)return q.instance;q.instance=this,this.canvas=t,this.socket=s,this.sizes=new St,this.time=new Mt,this.setScene(),this.setCamera(),this.setRenderer(),this.setResources(),this.setPreloader(),this.setWorld(),this.sizes.on("resize",()=>{this.onResize()}),this.update()}setScene(){this.scene=new Pt}setCamera(){this.camera=new It}setRenderer(){this.renderer=new Ct}setResources(){this.resources=new Ot(At)}setPreloader(){this.preloader=new Dt}setWorld(){this.world=new Yt}onResize(){this.camera.onResize(),this.renderer.onResize()}update(){this.preloader&&this.preloader.update(),this.camera&&this.camera.update(),this.renderer&&this.renderer.update(),this.world&&this.world.update(),this.time&&this.time.update(),window.requestAnimationFrame(()=>{this.update()})}};let w=q;z(w,"instance");const p=ae({canvas:".experience-canvas",chatContainer:".chat-container",messageSubmitButton:"#chat-message-button",messageInput:"#chat-message-input",inputWrapper:".message-input-wrapper",nameInputButton:"#name-input-button",nameInput:"#name-input",avatarLeftImg:".avatar-left",avatarRightImg:".avatar-right"}),Ie=new URL("/",window.location.href),Z=je(Ie.toString()+"chat"),K=je(Ie.toString()+"update");let X="";new w(p.canvas,K);Z.on("connect",()=>{});p.messageSubmitButton.addEventListener("click",Re);p.nameInputButton.addEventListener("click",qt);p.chatContainer.addEventListener("click",Ft);p.avatarLeftImg.addEventListener("click",Ce);p.avatarRightImg.addEventListener("click",De);document.addEventListener("keydown",Re);function Ft(){p.inputWrapper.classList.contains("hidden")&&p.inputWrapper.classList.remove("hidden")}function qt(){X=p.nameInput.value,Z.emit("setName",X),K.emit("setName",X)}function Ce(){K.emit("setAvatar","male"),p.avatarLeftImg.removeEventListener("click",Ce)}function De(){K.emit("setAvatar","female"),p.avatarRightImg.removeEventListener("click",De)}function Re(o){if(o.type==="click"||o.key==="Enter"){if(p.inputWrapper.classList.toggle("hidden"),p.messageInput.focus(),p.messageInput.value==="")return;ze(X,p.messageInput.value.substring(0,500),Ae()),Z.emit("send-message",p.messageInput.value.substring(0,500),Ae()),p.messageInput.value=""}}function Ae(){const o=new Date,t=o.getHours().toString().padStart(2,"0"),s=o.getMinutes().toString().padStart(2,"0");return`${t}:${s}`}function ze(o,t,s){const e=document.createElement("div");e.innerHTML=`<span class="different-color">[${s}] ${o}:</span> ${t}`,p.chatContainer.append(e),p.chatContainer.scrollTop=p.chatContainer.scrollHeight}Z.on("recieved-message",(o,t,s)=>{ze(o,t,s)});K.on("connect",()=>{});
